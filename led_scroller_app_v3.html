<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LED Scroller</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @keyframes marqueeAnim {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .marquee-text {
      font-size: var(--font-size, 80px);
      white-space: nowrap;
      display: inline-block;
      transition: text-shadow 0.2s;
    }
    .gradient-text {
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
    }
    .text-style-glow {
      text-shadow: 0 0 8px var(--text-color, #FFFFFF), 0 0 12px var(--text-color, #FFFFFF);
    }
    .text-style-outline {
      text-shadow:
        -2px -2px 0 var(--outline-color),
        2px -2px 0 var(--outline-color),
        -2px 2px 0 var(--outline-color),
        2px 2px 0 var(--outline-color),
        -3px 0 0 var(--outline-color),
        3px 0 0 var(--outline-color),
        0 -3px 0 var(--outline-color),
        0 3px 0 var(--outline-color);
    }
    .display-screen {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: var(--bg-color, #000);
      position: relative;
      box-sizing: border-box;
    }
    .border-style-solid {
      border: 8px solid white;
    }
    .border-style-rainbow {
      padding: 8px;
      position: relative;
      box-shadow: 0 0 25px rgba(255,100,255,0.7);
    }
    .border-style-rainbow::before {
      content: '';
      position: absolute;
      top:0; right:0; bottom:0; left:0;
      z-index:-1;
      margin:-8px;
      background: linear-gradient(45deg, red,orange,yellow,green,blue,indigo,violet,red);
      background-size:400% 400%;
      animation: rainbow-border-anim 2s linear infinite;
    }
    @keyframes rainbow-border-anim {
      0%{background-position:0% 50%;}
      100%{background-position:100% 50%;}
    }
  </style>
</head>
<body class="bg-gray-800 text-white h-screen overflow-hidden">

  <!-- Home / Controller / Display Views Omitted for Brevity, keep unchanged -->

  <!-- 完整原 UI HTML 結構請保留，此處省略 -->

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDiXuuIQB9EJQZtW8zYuTByxr-Y5wMpRdc",
      authDomain: "led-run-c168b.firebaseapp.com",
      projectId: "led-run-c168b",
      storageBucket: "led-run-c168b.appspot.com",
      messagingSenderId: "555557259748",
      appId: "1:555557259748:web:7a79d35743bcbadbf11ff1",
      measurementId: "G-7JH5TLX99R"
    };
    let db;
    try { db = getFirestore(initializeApp(firebaseConfig)); }
    catch (e) { console.error("Firebase 初始化失敗", e); alert("Firebase 連線失敗！"); }

    // 原本的 view 切換與啟動邏輯保留

    // Helpers injected by fixer: reset text paint and target collection
    function resetTextPaint(el) {
      if (!el) return;
      el.classList.remove('gradient-text');
      el.style.removeProperty('background');
      el.style.removeProperty('backgroundImage');
      el.style.removeProperty('color');
      el.style.removeProperty('-webkit-text-fill-color');
    }

    function getTargets() {
      const textEls = [
        document.getElementById('marquee-text'),
        document.getElementById('preview-marquee-text')
      ].filter(Boolean);
      const screens = Array.from(document.querySelectorAll('.display-screen'));
      return { textEls, screens };
    }

    // 取代原本的 applySettings
    function applySettings(settings) {
      const { textEls, screens } = getTargets();

      // Text content & size
      textEls.forEach(el => {
        if (typeof settings.text === 'string') el.textContent = settings.text;
        if (settings.fontSize) el.style.setProperty('--font-size', settings.fontSize + 'px');

        // Reset previous paint layers before applying new mode
        resetTextPaint(el);

        if (settings.colorMode === 'gradient') {
          el.classList.add('gradient-text');
          if (settings.gradientText) el.style.background = settings.gradientText;
          el.style.color = 'transparent';
          el.style.webkitTextFillColor = 'transparent';
        } else {
          if (settings.textColor) el.style.color = settings.textColor;
        }

        // Text effects
        el.classList.toggle('text-style-glow', settings.textStyle === 'glow');
        el.classList.toggle('text-style-outline', settings.textStyle === 'outline');
        if (settings.outlineColor) {
          el.style.setProperty('--outline-color', settings.outlineColor);
        }
      });

      // Background (solid/gradient) and background border
      screens.forEach(sc => {
        sc.style.removeProperty('background');
        sc.style.removeProperty('backgroundImage');

        if (settings.colorMode === 'gradient') {
          if (settings.gradientBg) sc.style.background = settings.gradientBg;
        } else {
          if (settings.backgroundColor) sc.style.background = settings.backgroundColor;
        }

        sc.classList.toggle('border-style-rainbow', settings.backgroundBorder === 'rainbow');
        sc.classList.toggle('border-style-solid', settings.backgroundBorder === 'solid');

        if (settings.backgroundBorder === 'rainbow') {
          sc.style.removeProperty('border-color');
          sc.style.removeProperty('border');
        }
      });
    }

    // 原本的 updateColorTab 加一行呼叫預覽更新
    function updateColorTab(active) {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('border-indigo-500', btn.dataset.tab === active);
        btn.classList.toggle('border-transparent', btn.dataset.tab !== active);
      });
      document.getElementById('solid-color-panel').classList.toggle('hidden', active !== 'solid');
      document.getElementById('gradient-color-panel').classList.toggle('hidden', active !== 'gradient');
      try { updatePreview(); } catch (e) {}
    }

    // 其餘如 setupControllerListeners、getSettings、updatePreview、updateSession、startControllerMode…等邏輯請保留
    // 只要呼叫 applySettings 即可套用新版樣式

  </script>
</body>
</html>
