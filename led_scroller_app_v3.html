<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LED Scroller App v3 - 優化版</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #000; color: #fff; }
    #console { position: fixed; top:0; left:0; right:0; background: rgba(0,0,0,.7); padding:10px; z-index:1000; }
    #console.hide { display: none; }
    #controls { display: flex; flex-wrap: wrap; gap:10px; align-items:center; }
    #controls label { margin-right:5px; }
    #preview { position:absolute; top:50px; left:0; right:0; bottom:0; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    #canvas { width:100%; height:100%; }
    input, select, button { padding:5px; font-size:14px; }
  </style>
</head>
<body>
  <div id="console">
    <div id="controls">
      <label>ID:</label><input id="panelId" type="text" placeholder="自動或輸入ID" />
      <label>顯示文字:</label><input id="textInput" type="text" value="Hello LED Scroller" />
      <label>文字顏色:</label><input id="textColor" type="color" value="#ffffff" />
      <label>文字漸層:</label><select id="textGradient"><option value="none">無</option><option value="linear">線性</option></select>
      <label>背景顏色:</label><input id="bgColor" type="color" value="#000000" />
      <label>背景漸層:</label><select id="bgGradient"><option value="none">無</option><option value="linear">線性</option></select>
      <label>邊框:</label><select id="borderStyle">
        <option value="none">無</option>
        <option value="solid">實線</option>
        <option value="gradient">漸層</option>
      </select>
      <label>邊框顏色:</label><input id="borderColor" type="color" value="#ffffff" />
      <label>字體大小:</label><input id="fontSize" type="number" value="80" />px
      <label>速度:</label><input id="speed" type="number" value="10" />s
      <label>方向:</label><select id="direction">
        <option value="left">← 向左</option>
        <option value="stop">❚❚ 靜止</option>
        <option value="right">向右 →</option>
      </select>
      <button id="applyBtn">套用</button>
      <button id="toggleConsole">切換顯示</button>
    </div>
  </div>
  <div id="preview">
    <canvas id="canvas"></canvas>
  </div>
  <script>
    (() => {
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      let width, height, offset = 0, animId = null;

      // 控制元件
      const textInput = document.getElementById('textInput');
      const textColor = document.getElementById('textColor');
      const textGradient = document.getElementById('textGradient');
      const bgColor = document.getElementById('bgColor');
      const bgGradient = document.getElementById('bgGradient');
      const borderStyle = document.getElementById('borderStyle');
      const borderColor = document.getElementById('borderColor');
      const fontSize = document.getElementById('fontSize');
      const speed = document.getElementById('speed');
      const direction = document.getElementById('direction');
      const applyBtn = document.getElementById('applyBtn');
      const toggleConsole = document.getElementById('toggleConsole');
      const consoleEl = document.getElementById('console');

      // 調整畫布尺寸
      function resize() {
        width = canvas.width = canvas.clientWidth;
        height = canvas.height = canvas.clientHeight;
      }
      window.addEventListener('resize', resize);
      resize();

      // 繪製函式
      function draw() {
        ctx.clearRect(0,0,width,height);
        // 背景
        if (bgGradient.value === 'linear') {
          const grad = ctx.createLinearGradient(0,0,width,0);
          grad.addColorStop(0, bgColor.value);
          grad.addColorStop(1, borderStyle.value==='gradient'? borderColor.value : '#000');
          ctx.fillStyle = grad;
        } else {
          ctx.fillStyle = bgColor.value;
        }
        ctx.fillRect(0,0,width,height);

        // 邊框
        if (borderStyle.value === 'solid') {
          ctx.strokeStyle = borderColor.value;
          ctx.lineWidth = 10;
          ctx.strokeRect(0,0,width,height);
        } else if (borderStyle.value === 'gradient') {
          const bgrad = ctx.createLinearGradient(0,0,width,0);
          bgrad.addColorStop(0, borderColor.value);
          bgrad.addColorStop(1, bgColor.value);
          ctx.strokeStyle = bgrad;
          ctx.lineWidth = 10;
          ctx.strokeRect(0,0,width,height);
        }

        // 文字
        ctx.font = `${fontSize.value}px sans-serif`;
        const text = textInput.value;
        const textWidth = ctx.measureText(text).width;
        let x = offset;
        if (direction.value === 'right') x = width - offset - textWidth;
        offset += (width + textWidth) / (speed.value * 60);
        if (offset > width + textWidth) offset = 0;

        // 漸層文字設定
        if (textGradient.value === 'linear') {
          const tgrad = ctx.createLinearGradient(0,0,textWidth,0);
          tgrad.addColorStop(0, textColor.value);
          tgrad.addColorStop(1, bgGradient.value==='linear'? bgColor.value : '#fff');
          ctx.fillStyle = tgrad;
        } else {
          ctx.fillStyle = textColor.value;
        }

        ctx.fillText(text, direction.value==='left'? width-offset : x, height/2 + parseInt(fontSize.value)/2 - 10);
        animId = requestAnimationFrame(draw);
      }

      // 初始呼叫
      applyBtn.addEventListener('click', () => {
        offset = 0;
        if (animId) cancelAnimationFrame(animId);
        draw();
      });

      toggleConsole.addEventListener('click', () => {
        consoleEl.classList.toggle('hide');
      });

      // 預設啟動
      applyBtn.click();
    })();
  </script>
</body>
</html>
